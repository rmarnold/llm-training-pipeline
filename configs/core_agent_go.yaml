run_name: "gpt-oss-20b-core-agent-go-v1"

model:
  base_model: "checkpoints/coding_tui/final_merged"  # TUI checkpoint — coding skills already baked in
  merge_lang_adapter: false  # No lang adapter; TUI base already contains target language skills
  max_seq_length: 32768  # Agent sessions are multi-turn (32k with packing)
  load_in_4bit: true
  dtype: null

lora:
  r: 128  # Higher rank — agent behavior needs more capacity
  lora_alpha: 256
  # GPT-OSS 20B MoE: these configs are IGNORED for MoE models.
  # apply_lora_config() auto-detects MoE and uses regex targeting.
  target_modules:
    - "q_proj"
    - "k_proj"
    - "v_proj"
    - "o_proj"
    - "gate_up_proj"
    - "down_proj"
  lora_dropout: 0
  bias: "none"
  use_gradient_checkpointing: "unsloth"
  use_rslora: false

data:
  train_data: "data/go/core_agent/train"
  val_data: "data/go/core_agent/val"
  max_seq_length: 32768

training:
  num_train_epochs: 2
  max_steps: -1
  learning_rate: 3.0e-5  # Slightly more aggressive for behavioral SFT
  lr_scheduler_type: "cosine"
  warmup_ratio: 0.05

  per_device_train_batch_size: 1
  gradient_accumulation_steps: 4  # Smaller effective batch (trajectories are long)

  bf16: true
  max_grad_norm: 0.5  # Tighter for long-context stability
  weight_decay: 0.01
  optim: "adamw_8bit"
  packing: true  # Unsloth padding-free batching (3-5x faster, 30% less VRAM)
  seed: 42

logging:
  logging_steps: 5
  eval_steps: 250
  save_steps: 250
  save_total_limit: 3
  report_to: ["tensorboard"]

checkpointing:
  output_dir: "checkpoints/core_agent_go"

# Tool definitions available to the agent during Go training sessions
tools:
  - name: "run_command"
    description: "Execute a shell command in the sandbox"
  - name: "read_file"
    description: "Read file contents"
  - name: "apply_patch"
    description: "Apply a unified diff"
  - name: "repo_search"
    description: "Semantic search across the codebase"
  - name: "run_tests"
    description: "Run test suite"
  - name: "go_doc"
    description: "Show documentation for a Go package or symbol (replaces pip_show)"
  - name: "search_pkg_go_dev"
    description: "Search for Go packages on pkg.go.dev (replaces search_pypi)"
  - name: "read_error"
    description: "Look up Go compiler error or runtime panic explanation"
