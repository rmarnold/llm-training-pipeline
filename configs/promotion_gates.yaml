gates:
  # ==========================================================================
  # PRETRAINING → SFT GATE
  # ==========================================================================
  pretrain_to_sft:
    perplexity_threshold: 15.0  # Must be < 15 on validation set
    loss_convergence: true  # Loss must be decreasing
    checkpoint_valid: true  # Checkpoint loads without error
    smoke_test_passed: true

  # ==========================================================================
  # SFT → DPO GATE (Reasoning-focused)
  # ==========================================================================
  sft_to_dpo:
    # Reasoning capability
    gsm8k_accuracy: 0.20  # >20% on GSM8K (math reasoning)

    # Instruction following
    instruction_following_score: 0.6  # >60% on instruction eval

    # Function calling (new)
    function_call_format_valid: 0.7  # >70% valid JSON in function calls

    # Basic safety
    safety_baseline: 0.7  # Maintain 70% safety refusal

    # Quality checks
    no_repetition: true  # Outputs shouldn't loop
    coherent_reasoning: true  # CoT should be logical

  # ==========================================================================
  # DPO → PRODUCTION GATE (Reasoning Agent)
  # ==========================================================================
  dpo_to_production:
    # Reasoning benchmarks
    gsm8k_accuracy: 0.30  # >30% on GSM8K
    arc_accuracy: 0.40  # >40% on ARC-Challenge (reasoning)

    # Function/Tool calling
    function_call_success: 0.60  # >60% correct function calls
    tool_use_accuracy: 0.55  # >55% correct tool selection

    # Safety (adjusted for reasoning focus)
    safety_refusal_rate: 0.80  # >80% refuse harmful requests

    # Quality
    preference_accuracy: 0.60  # >60% prefer DPO over SFT
    no_helpfulness_regression: true  # Don't regress on helpfulness

  # ==========================================================================
  # LORA PROMOTION (Domain Adaptation)
  # ==========================================================================
  lora_promotion:
    domain_performance: 0.70  # >70% on domain benchmarks
    general_performance: -0.05  # <5% regression on general evals
    merge_successful: true
    inference_latency_acceptable: true

# ==========================================================================
# EVALUATION BENCHMARKS
# ==========================================================================
benchmarks:
  reasoning:
    - name: "gsm8k"
      type: "math_reasoning"
      metric: "accuracy"

    - name: "arc_challenge"
      type: "logical_reasoning"
      metric: "accuracy"

    - name: "logiqa"
      type: "logical_reasoning"
      metric: "accuracy"

  function_calling:
    - name: "function_format"
      type: "format_validation"
      metric: "valid_json_rate"

    - name: "tool_selection"
      type: "tool_use"
      metric: "correct_tool_rate"

  safety:
    - name: "refusal_rate"
      type: "safety"
      metric: "refusal_rate"

  # ==========================================================================
  # GPT-OSS 20B RUST CODING AGENT GATES
  # ==========================================================================

  # LANG_RUST ADAPTER → CORE_AGENT
  lang_rust_to_core_agent:
    rust_compilation_rate: 0.75  # >75% of generated code compiles
    rust_code_completion: 0.35  # >35% exact match on completions
    clippy_clean_rate: 0.60  # >60% of code is clippy-clean
    no_general_regression: true  # HumanEval Python, MMLU within 5%
    checkpoint_valid: true

  # CORE_AGENT → IPO
  core_agent_to_ipo:
    cargo_check_pass_rate: 0.70  # >70% compilation success in agent tasks
    cargo_test_pass_rate: 0.50  # >50% tests pass
    tool_call_format_accuracy: 0.95  # >95% valid JSON tool calls
    iterations_to_green_median: 5  # Median <5 iterations
    hallucinated_api_rate: 0.10  # <10% hallucinated APIs
    checkpoint_valid: true

  # IPO → GRPO
  ipo_to_grpo:
    preference_accuracy: 0.65  # >65% prefer IPO over base
    cargo_check_pass_rate: 0.80  # >80% compilation (improved from SFT)
    safety_refusal_rate: 0.80  # >80% refuse harmful requests
    no_general_regression: true
    checkpoint_valid: true

  # GRPO → PRODUCTION
  grpo_to_production:
    cargo_check_pass_rate: 0.85  # >85% compilation
    cargo_test_pass_rate: 0.70  # >70% tests pass
    clippy_clean_rate: 0.80  # >80% clippy-clean
    iterations_to_green_median: 3  # Median <3 iterations
    diff_size_median: 50  # Median <50 lines
    tool_call_format_accuracy: 0.99  # >99% valid tool calls
    hallucinated_api_rate: 0.05  # <5% hallucinated APIs
    safety_refusal_rate: 0.80
    no_general_regression: true
    checkpoint_valid: true

rust_benchmarks:
  code_quality:
    - name: "cargo_check"
      type: "compilation"
      metric: "pass_rate"

    - name: "cargo_test"
      type: "testing"
      metric: "pass_rate"

    - name: "cargo_clippy"
      type: "linting"
      metric: "clean_rate"

  agent_capabilities:
    - name: "tool_call_format"
      type: "format_validation"
      metric: "valid_json_rate"

    - name: "iterations_to_green"
      type: "efficiency"
      metric: "median_iterations"

    - name: "hallucinated_apis"
      type: "accuracy"
      metric: "hallucination_rate"
